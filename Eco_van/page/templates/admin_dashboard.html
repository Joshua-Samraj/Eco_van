{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
</head>

<body>
  <!-- Background Video -->
  <video autoplay muted loop id="bg-video">
    <source id="bg-video-source" src="{% static 'videos/cyberpunk.mp4' %}" type="video/mp4">
    Your browser does not support HTML5 video.
  </video>

  <div class="container">
    <h2>Admin Dashboard</h2>

    <label for="theme-select" style="color: var(--primary-color); font-weight:700;">Choose Theme:</label>
    <select id="theme-select" aria-label="Select Theme" style="margin-bottom:20px; padding:6px 10px; border-radius:6px; border:none; font-family: 'Orbitron', monospace;">
      <option value="cyberpunk">Cyberpunk</option>
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>

    <p><a href="{% url 'admin_logout' %}">Logout</a></p>

    {% if messages %}
    <div class="messages">
      {% for message in messages %}
        <p>{{ message }}</p>
      {% endfor %}
    </div>
    {% endif %}

    <form method="post" onsubmit="stripFormattedNumbers()">
      {% csrf_token %}
      
      <label>Raised Amount:</label>
      <input type="text" id="raised_display" value="{{ fund_data.raised|intcomma }}" oninput="formatNumber(this)">
      <input type="hidden" name="raised" id="raised" value="{{ fund_data.raised }}">

      <label>Goal Amount:</label>
      <input type="text" id="goal_display" value="{{ fund_data.goal|intcomma }}" oninput="formatNumber(this)">
      <input type="hidden" name="goal" id="goal" value="{{ fund_data.goal }}">

      <button type="submit">Update Fund Data</button>
      <a href="{% url 'index' %}">Home</a>
    </form>
  </div>

  <script>
    const themeSelect = document.getElementById('theme-select');
    const bgVideoSource = document.getElementById('bg-video-source');
    const bgVideo = document.getElementById('bg-video');
    const body = document.body;

    const themeVideos = {
      cyberpunk: "{% static 'css/image/cyber.mp4' %}",
      dark: "{% static 'css/image/videoplayback.mp4' %}",
      light: "{% static 'css/image/white.mp4' %}"
    };

    function changeTheme(theme) {
      // Remove all theme classes
      body.classList.remove('cyberpunk', 'dark', 'light');
      body.classList.add(theme);

      // Change background video
      bgVideoSource.src = themeVideos[theme];
      bgVideo.load();

      // Save to localStorage
      localStorage.setItem("adminDashboardTheme", theme);
    }

    // Load saved theme
    window.onload = () => {
      const savedTheme = localStorage.getItem("adminDashboardTheme") || "cyberpunk";
      themeSelect.value = savedTheme;
      changeTheme(savedTheme);
    };

    themeSelect.addEventListener('change', () => {
      const selected = themeSelect.value;
      changeTheme(selected);
    });

    // Number formatting
    function formatNumber(input) {
      let value = input.value.replace(/,/g, '').replace(/[^\d]/g, '');
      if (value) {
        input.value = Number(value).toLocaleString('en-IN');
      } else {
        input.value = '';
      }

      if (input.id === "raised_display") {
        document.getElementById("raised").value = value;
      } else if (input.id === "goal_display") {
        document.getElementById("goal").value = value;
      }
    }

    function stripFormattedNumbers() {
      const raisedValue = document.getElementById("raised_display").value.replace(/,/g, '');
      const goalValue = document.getElementById("goal_display").value.replace(/,/g, '');
      document.getElementById("raised").value = raisedValue;
      document.getElementById("goal").value = goalValue;
    }
  </script>
</body>
</html>
